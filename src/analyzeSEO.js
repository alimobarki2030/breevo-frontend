// Enhanced Product Categorization with Better AI Logic
const enhancedProductCategorization = (product) => {
  
  // Multi-step categorization process
  const categorizeProduct = async (product) => {
    
    // Step 1: Extract all available information
    const productName = product.name?.trim() || '';
    
    // Step 2: Enhanced categorization prompt with multiple data sources
    const categorizationPrompt = `أنت خبير تصنيف منتجات محترف متخصص في السوق السعودي.

مهمتك: تحليل المعلومات التالية وتحديد الفئة الصحيحة للمنتج.

معلومات المنتج:
العنوان: "${productName}"

قواعد التصنيف (مهمة جداً):

1. منتجات التجميل والعناية:
   - كلمات مفتاحية: كريم، مرطب، شامبو، صابون، عطر، مكياج، سيروم، تونر، غسول، بلسم، ماسك
   - أمثلة: "كريم مرطب للوجه"، "شامبو للشعر"، "عطر رجالي"
   - الفئة: "تجميل وعناية"

2. الإلكترونيات والتقنية:
   - كلمات مفتاحية: هاتف، جهاز، كمبيوتر، تلفزيون، سماعات، شاحن، كابل، موبايل، آيفون، سامسونج
   - أمثلة: "هاتف آيفون 15"، "سماعات بلوتوث"، "شاحن لاسلكي"
   - الفئة: "إلكترونيات وتقنية"

3. الملابس والأزياء:
   - كلمات مفتاحية: قميص، بنطال، فستان، حذاء، جاكيت، تيشيرت، بلوزة، صندل، حقيبة
   - أمثلة: "قميص قطني"، "حذاء رياضي"، "فستان سهرة"
   - الفئة: "ملابس وأزياء"

4. الطعام والمشروبات:
   - كلمات مفتاحية: طعام، شراب، قهوة، شاي، عصير، حلويات، خبز، أرز، معكرونة
   - أمثلة: "قهوة عربية"، "عصير برتقال"، "شوكولاتة"
   - الفئة: "أغذية ومشروبات"

5. المنزل والديكور:
   - كلمات مفتاحية: أثاث، طاولة، كرسي، سجادة، وسادة، مصباح، ستارة، مرآة
   - أمثلة: "طاولة خشبية"، "سجادة فارسية"، "مصباح LED"
   - الفئة: "منزل وديكور"

6. الصحة والطب:
   - كلمات مفتاحية: دواء، فيتامين، مكمل، طبي، علاج، صحة، أدوية، حبوب
   - أمثلة: "فيتامين د"، "مكمل البروتين"، "جهاز قياس ضغط"
   - الفئة: "صحة وطب"

7. الرياضة واللياقة:
   - كلمات مفتاحية: رياضة، تمرين، جيم، لياقة، أوزان، دراجة، كرة، معدات رياضية
   - أمثلة: "دراجة هوائية"، "أوزان حديد"، "كرة قدم"
   - الفئة: "رياضة ولياقة"

8. السيارات والمركبات:
   - كلمات مفتاحية: سيارة، مركبة، إطار، محرك، قطع غيار، زيت، فلتر
   - أمثلة: "إطارات سيارة"، "زيت المحرك"، "مرآة جانبية"
   - الفئة: "سيارات ومركبات"

خطوات التحليل:
1. اقرأ العنوان والوصف بعناية
2. ابحث عن الكلمات المفتاحية في النص
3. طابق مع الفئات المحددة أعلاه
4. اختر الفئة الأكثر دقة

مثال توضيحي:
المنتج: "كريم مرطب للوجه للبشرة الحساسة من Eucerin"
التحليل: يحتوي على "كريم مرطب" و "للوجه" = منتج تجميل
الفئة: "تجميل وعناية"

الآن حلل المنتج المعطى واختر الفئة الصحيحة.

أعد فقط اسم الفئة بدون شرح:`;

    return categorizationPrompt;
  };

  // Step 3: Target audience analysis with better context
  const analyzeTargetAudience = async (product, category) => {
    const audiencePrompt = `بناءً على المنتج والفئة التالية، حدد الجمهور المستهدف:

المنتج: "${product.name}"
الفئة: "${category}"

قواعد تحديد الجمهور:

للتجميل والعناية:
- منتجات الوجه والعناية بالبشرة → "النساء والرجال"
- مكياج وأحمر شفاه → "النساء"
- كريمات حلاقة ومنتجات اللحية → "الرجال"
- منتجات الأطفال → "الأمهات والآباء"
- منتجات مكافحة الشيخوخة → "البالغين 30+"

للإلكترونيات:
- ألعاب وقيمنق → "الشباب والمراهقين"
- أجهزة مكتبية → "المهنيين والموظفين"
- هواتف ذكية → "الجميع"
- أجهزة منزلية ذكية → "العائلات"

للملابس:
- ملابس رجالية → "الرجال"
- ملابس نسائية → "النساء"
- ملابس أطفال → "الأمهات والآباء"
- ملابس رياضية → "الرياضيين والشباب"

للطعام:
- أطعمة أطفال → "الأمهات والآباء"
- مكملات رياضية → "الرياضيين"
- أطعمة صحية → "المهتمين بالصحة"
- حلويات → "العائلات والأطفال"

حدد الجمهور الأنسب للمنتج المذكور.

أعد فقط وصف الجمهور المستهدف:`;

    return audiencePrompt;
  };

  // Step 4: Tone selection based on category and audience
  const selectTone = (category, audience) => {
    const toneMap = {
      "تجميل وعناية": "ناعمة",
      "إلكترونيات وتقنية": "محايدة", 
      "ملابس وأزياء": "دافئة",
      "أغذية ومشروبات": "دافئة",
      "منزل وديكور": "دافئة",
      "صحة وطب": "رسمية",
      "رياضة ولياقة": "حماسية",
      "سيارات ومركبات": "عملية"
    };
    
    return toneMap[category] || "محايدة";
  };

  // Step 5: Story arc selection
  const selectStoryArc = (category) => {
    const storyMap = {
      "تجميل وعناية": "قبل-بعد",
      "إلكترونيات وتقنية": "مشكلة-حل",
      "ملابس وأزياء": "رحلة-التحول", 
      "أغذية ومشروبات": "التجربة",
      "منزل وديكور": "رحلة-التحول",
      "صحة وطب": "مشكلة-حل",
      "رياضة ولياقة": "قبل-بعد",
      "سيارات ومركبات": "مشكلة-حل"
    };
    
    return storyMap[category] || "مشكلة-حل";
  };

  return {
    categorizeProduct,
    analyzeTargetAudience,
    selectTone,
    selectStoryArc
  };
};

export default enhancedProductCategorization;